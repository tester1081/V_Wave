<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Veltrawave - Cable Subscription</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Reset and Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

:root {
    --primary-color: #1e40af;
    --secondary-color: #3b82f6;
    --accent-color: #60a5fa;
    --light-bg: #f8fafc;
    --dark-text: #1e293b;
    --light-text: #f8fafc;
    --border-color: #e2e8f0;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --danger-color: #ef4444;
    --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --transition-speed: 0.3s;
    --dstv-color: #0066b2;
    --gotv-color: #00a651;
    --startime-color: #e31837;
}

body {
    background-color: var(--light-bg);
    color: var(--dark-text);
    min-height: 100vh;
    position: relative;
    padding-bottom: 70px; /* Space for bottom nav */
}

/* Cable Page Styles */
.cable-container {
    max-width: 500px;
    margin: 0 auto;
    padding: 0 1rem;
    padding-bottom: 80px;
}

/* Header Styles */
.page-header {
    display: flex;
    align-items: center;
    padding: 1rem 0;
    margin-bottom: 1rem;
}

.back-button {
    background: none;
    border: none;
    font-size: 1.2rem;
    color: var(--dark-text);
    margin-right: 1rem;
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.back-button:active {
    background-color: rgba(0, 0, 0, 0.05);
}

.page-title {
    font-size: 1.2rem;
    font-weight: 600;
}

/* Provider Slider */
.provider-slider-container {
    margin-bottom: 1.5rem;
    position: relative;
}

.slider-indicators {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
}

.indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #e2e8f0;
    margin: 0 4px;
    transition: all 0.3s ease;
}

.indicator.active {
    background-color: var(--primary-color);
    width: 20px;
    border-radius: 4px;
}

.provider-slider {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    gap: 1rem;
    padding: 0.5rem 0;
}

.provider-slider::-webkit-scrollbar {
    display: none;
}

.provider-option {
    flex: 0 0 100%;
    scroll-snap-align: start;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    background-color: white;
    border-radius: 1rem;
    box-shadow: var(--card-shadow);
    transition: all 0.3s ease;
    cursor: pointer;
}

.provider-option.selected {
    background-color: #eff6ff;
    border: 2px solid var(--primary-color);
    transform: translateY(-5px);
}

.provider-option:active {
    transform: scale(0.98);
}

.provider-option:hover {
    transform: translateY(-5px);
}

.provider-image {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    position: relative;
    overflow: hidden;
}

.provider-option.dstv .provider-image {
    background-color: var(--dstv-color);
}

.provider-option.gotv .provider-image {
    background-color: var(--gotv-color);
}

.provider-option.startime .provider-image {
    background-color: var(--startime-color);
}

.provider-image img {
    width: 60px;
    height: 60px;
    object-fit: contain;
}

.provider-logo {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.2rem;
}

.provider-name {
    font-weight: 600;
    font-size: 1.2rem;
}

.provider-option.dstv .provider-name {
    color: var(--dstv-color);
}

.provider-option.gotv .provider-name {
    color: var(--gotv-color);
}

.provider-option.startime .provider-name {
    color: var(--startime-color);
}

/* Form Styles */
.form-container {
    background-color: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: var(--card-shadow);
    margin-bottom: 1.5rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #475569;
}

.input-wrapper {
    position: relative;
}

.input-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
}

.form-input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    font-size: 1rem;
    transition: all var(--transition-speed);
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

.form-input.provider-display {
    background-color: #f1f5f9;
    font-weight: 600;
}

.form-select {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    font-size: 1rem;
    transition: all var(--transition-speed);
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1rem;
}

.form-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

.form-select:disabled {
    background-color: #f1f5f9;
    cursor: not-allowed;
}

.btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 0.75rem;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-speed);
    text-align: center;
}

.btn-primary {
    background-color: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background-color: #1e3a8a;
}

.btn-primary:active {
    transform: scale(0.98);
}

.btn-primary:disabled {
    background-color: #93c5fd;
    cursor: not-allowed;
}

.btn-block {
    display: block;
    width: 100%;
}

/* Popular Plans */
.popular-plans {
    margin-bottom: 1.5rem;
}

.plans-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.plan-card {
    background-color: white;
    border-radius: 0.75rem;
    padding: 1rem;
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: border-color var(--transition-speed), transform var(--transition-speed);
}

.plan-card:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
}

.plan-card.selected {
    border-color: var(--primary-color);
    background-color: rgba(59, 130, 246, 0.05);
}

.plan-name {
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.plan-details {
    font-size: 0.8rem;
    color: #64748b;
    margin-bottom: 0.5rem;
}

.plan-price {
    font-weight: 600;
    color: var(--primary-color);
}

/* Bottom Navigation */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex;
    justify-content: space-around;
    padding: 0.75rem 0;
    box-shadow: 0 -1px 10px rgba(0, 0, 0, 0.05);
    z-index: 1000;
    border-top: 1px solid rgba(226, 232, 240, 0.8);
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #64748b;
    text-decoration: none;
    font-size: 0.7rem;
    transition: color var(--transition-speed);
}

.nav-item.active {
    color: var(--primary-color);
}

.nav-icon {
    font-size: 1.2rem;
    margin-bottom: 0.25rem;
    position: relative;
}

.nav-item.active .nav-icon::after {
    content: "";
    position: absolute;
    bottom: -5px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background-color: var(--primary-color);
}

/* Toast Notification - Updated */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    width: 300px;
    max-width: 90%;
}

.toast {
    background-color: white;
    border-radius: 0.75rem;
    padding: 1rem;
    margin-bottom: 0.75rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    animation: slideInRight 0.4s ease-out forwards;
    overflow: hidden;
    transform-origin: right;
}

.toast.success {
    border-left: 4px solid var(--success-color);
    background-color: rgba(16, 185, 129, 0.05);
}

.toast.error {
    border-left: 4px solid var(--danger-color);
    background-color: rgba(239, 68, 68, 0.05);
}

.toast.info {
    border-left: 4px solid var(--primary-color);
    background-color: rgba(59, 130, 246, 0.05);
}

.toast-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 0.75rem;
    flex-shrink: 0;
    font-size: 1.1rem;
}

.toast.success .toast-icon {
    background-color: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.toast.error .toast-icon {
    background-color: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.toast.info .toast-icon {
    background-color: rgba(59, 130, 246, 0.1);
    color: var(--primary-color);
}

.toast-content {
    flex: 1;
}

.toast-message {
    font-size: 0.95rem;
    margin-bottom: 0.25rem;
    font-weight: 500;
}

.toast-action {
    margin-top: 0.5rem;
}

.toast-action button {
    background-color: transparent;
    border: none;
    color: var(--primary-color);
    font-weight: 500;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
}

.toast-action button:hover {
    background-color: rgba(59, 130, 246, 0.1);
}

.toast-close {
    color: #94a3b8;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    margin-left: 0.5rem;
    font-size: 1rem;
}

/* Confirmation Modal */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal {
    background-color: white;
    border-radius: 1rem;
    width: calc(100% - 2rem);
    max-width: 400px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    transform: scale(0.9);
    opacity: 0;
    transition: all 0.3s ease;
}

.modal-overlay.active .modal {
    transform: scale(1);
    opacity: 1;
}

.modal-header {
    padding: 1.5rem 1.5rem 0.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-title {
    font-size: 1.2rem;
    font-weight: 600;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.2rem;
    color: #94a3b8;
    cursor: pointer;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    background-color: #f1f5f9;
}

.modal-body {
    padding: 0.5rem 1.5rem 1.5rem;
}

.modal-footer {
    padding: 1rem 1.5rem 1.5rem;
    display: flex;
    gap: 1rem;
}

.btn-secondary {
    background-color: #f1f5f9;
    color: var(--dark-text);
}

.btn-secondary:hover {
    background-color: #e2e8f0;
}

.confirmation-details {
    background-color: #f8fafc;
    border-radius: 0.75rem;
    padding: 1rem;
    margin-bottom: 1rem;
}

.confirmation-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.confirmation-item:last-child {
    margin-bottom: 0;
    padding-top: 0.5rem;
    border-top: 1px dashed #e2e8f0;
    font-weight: 600;
}

.confirmation-label {
    color: #64748b;
}

.confirmation-value {
    font-weight: 500;
}

/* Loading Spinner */
.loading {
    display: inline-block;
    width: 1rem;
    height: 1rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
    margin-left: 0.5rem;
    vertical-align: middle;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}
</style>
</head>
<body>
<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="confirmationModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Confirm Subscription</div>
            <button class="modal-close" id="closeModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p>Please confirm your cable subscription with the following details:</p>
            <div class="confirmation-details" id="confirmationDetails">
                <!-- Details will be populated dynamically -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelPurchase">Cancel</button>
            <button class="btn btn-primary" id="confirmPurchase">Confirm Purchase</button>
        </div>
    </div>
</div>

<!-- Cable Page -->
<div class="cable-container">
    <div class="page-header">
        <button class="back-button" onclick="window.location.href='dashboard.html'">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 class="page-title">Cable TV Subscription</h1>
    </div>

    <div class="provider-slider-container">
        <div class="slider-indicators">
            <div class="indicator active" data-index="0"></div>
            <div class="indicator" data-index="1"></div>
            <div class="indicator" data-index="2"></div>
        </div>
        <div class="provider-slider" id="providerSlider">
            <div class="provider-option dstv" data-provider="DSTV" data-provider-id="2">
                <div class="provider-image">
                    <div class="provider-logo">DSTV</div>
                </div>
                <div class="provider-name">DSTV</div>
            </div>
            
            <div class="provider-option gotv" data-provider="GOTV" data-provider-id="1">
                <div class="provider-image">
                    <div class="provider-logo">GOTV</div>
                </div>
                <div class="provider-name">GOTV</div>
            </div>
            
            <div class="provider-option startime" data-provider="STARTIME" data-provider-id="3">
                <div class="provider-image">
                    <div class="provider-logo">ST</div>
                </div>
                <div class="provider-name">STARTIME</div>
            </div>
        </div>
    </div>

    <div class="form-container">
        <form id="cableForm">
            <div class="form-group">
                <label for="selectedProvider" class="form-label">Selected Provider</label>
                <div class="input-wrapper">
                    <i class="fas fa-tv input-icon"></i>
                    <input type="text" id="selectedProvider" class="form-input provider-display" readonly>
                </div>
            </div>
            
            <div class="form-group">
                <label for="cablePlan" class="form-label">Select Package</label>
                <div class="input-wrapper">
                    <i class="fas fa-tag input-icon"></i>
                    <select id="cablePlan" class="form-select" disabled>
                        <option value="" selected disabled>Select Package</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="iucNumber" class="form-label">IUC/Smart Card Number</label>
                <div class="input-wrapper">
                    <i class="fas fa-credit-card input-icon"></i>
                    <input type="text" id="iucNumber" class="form-input" placeholder="Enter IUC/Smart Card Number">
                </div>
            </div>

            <button type="submit" id="submitButton" class="btn btn-primary btn-block" disabled>
                <span id="buttonText">Pay Now</span>
            </button>
        </form>
    </div>
    
    <div class="popular-plans">
        <div class="section-header">
            <h2 class="section-title">Popular Plans</h2>
        </div>
        <div class="plans-grid" id="popularPlans">
            <!-- Popular plans will be populated dynamically -->
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
    <a href="dashboard.html" class="nav-item">
        <div class="nav-icon"><i class="fas fa-home"></i></div>
        <div class="nav-label">Home</div>
    </a>
    <a href="games.html" class="nav-item">
        <div class="nav-icon"><i class="fas fa-gamepad"></i></div>
        <div class="nav-label">Game Top up</div>
    </a>
    <a href="#" class="nav-item">
        <div class="nav-icon"><i class="fas fa-shopping-bag"></i></div>
        <div class="nav-label">Store</div>
    
    <a href="profile.html" class="nav-item">
        <div class="nav-icon"><i class="fas fa-user"></i></div>
        <div class="nav-label">Profile</div>
    </a>
</div>

<script>
// API credentials
const ACCESS_TOKEN = "3cfedeade5a3a75342ce13245ac4de9e9b3ca0aaf86a05a5aa1447c12d7d";

// Cable plans data
const CABLE_PLANS = {
    "DSTV": [
        { id: 1, name: "DStv Padi", price: 4400, details: "Basic entertainment package" },
        { id: 2, name: "DSTV -YANGA", price: 6000, details: "Local entertainment package" },
        { id: 9, name: "DStv Premium-Asia", price: 33000, details: "Premium package with Asian channels" },
        { id: 10, name: "DStv Confam + ExtraView", price: 14200, details: "Confam with extra viewing" },
        { id: 34, name: "Dstv Confam", price: 11000, details: "Family entertainment package" },
        { id: 35, name: "DStv Compact", price: 19000, details: "Compact entertainment package" },
        { id: 36, name: "DStv Premium", price: 44000, details: "Premium entertainment package" },
        { id: 37, name: "DStv Asia", price: 10000, details: "Asian channels package" },
        { id: 38, name: "DStv Compact Plus", price: 30000, details: "Enhanced compact package" },
        { id: 43, name: "DStv Padi + ExtraView", price: 5400, details: "Padi with extra viewing" }
    ],
    "GOTV": [
        { id: 59, name: "GOtv Max", price: 8500, details: "Maximum entertainment package" },
        { id: 60, name: "GOtv Jolli", price: 5800, details: "Family entertainment package" },
        { id: 61, name: "GOtv Jinja", price: 3900, details: "Basic entertainment package" },
        { id: 62, name: "GOtv Smallie - monthly", price: 1900, details: "Mini monthly package" },
        { id: 65, name: "GOtv Supa - monthly", price: 11400, details: "Super entertainment package" }
    ],
    "STARTIME": [
        { id: 66, name: "Nova - 1 Month", price: 1700, details: "Basic monthly package" },
        { id: 67, name: "Basic (Antenna) - 1 Month", price: 3000, details: "Basic antenna package" },
        { id: 68, name: "Smart (Dish) -1 Month", price: 3500, details: "Smart dish package" },
        { id: 69, name: "Classic (Antenna) - 1 Month", price: 4500, details: "Classic antenna package" },
        { id: 70, name: "Super (Dish) - 1 Month", price: 7500, details: "Super dish package" },
        { id: 71, name: "Nova - 1 Week", price: 500, details: "Basic weekly package" },
        { id: 72, name: "Basic (Antenna) - 1 Week", price: 900, details: "Basic antenna weekly" },
        { id: 73, name: "Smart (Dish) -- 1 Week", price: 1100, details: "Smart dish weekly" },
        { id: 74, name: "Classic (Antenna) - 1 Week", price: 1500, details: "Classic antenna weekly" },
        { id: 75, name: "Super (Dish) - 1 Week", price: 2200, details: "Super dish weekly" }
    ]
};

// Popular plans for each provider
const POPULAR_PLANS = {
    "DSTV": [
        { id: 1, name: "DStv Padi", price: 4400, details: "Basic entertainment package" },
        { id: 34, name: "Dstv Confam", price: 11000, details: "Family entertainment package" },
        { id: 35, name: "DStv Compact", price: 19000, details: "Compact entertainment package" },
        { id: 36, name: "DStv Premium", price: 44000, details: "Premium entertainment package" }
    ],
    "GOTV": [
        { id: 61, name: "GOtv Jinja", price: 3900, details: "Basic entertainment package" },
        { id: 60, name: "GOtv Jolli", price: 5800, details: "Family entertainment package" },
        { id: 59, name: "GOtv Max", price: 8500, details: "Maximum entertainment package" },
        { id: 65, name: "GOtv Supa - monthly", price: 11400, details: "Super entertainment package" }
    ],
    "STARTIME": [
        { id: 66, name: "Nova - 1 Month", price: 1700, details: "Basic monthly package" },
        { id: 67, name: "Basic (Antenna) - 1 Month", price: 3000, details: "Basic antenna package" },
        { id: 69, name: "Classic (Antenna) - 1 Month", price: 4500, details: "Classic antenna package" },
        { id: 70, name: "Super (Dish) - 1 Month", price: 7500, details: "Super dish package" }
    ]
};

// DOM elements
const providerSlider = document.getElementById('providerSlider');
const sliderIndicators = document.querySelectorAll('.indicator');
const providerOptions = document.querySelectorAll('.provider-option');
const selectedProviderInput = document.getElementById('selectedProvider');
const cablePlanSelect = document.getElementById('cablePlan');
const iucNumberInput = document.getElementById('iucNumber');
const submitButton = document.getElementById('submitButton');
const buttonText = document.getElementById('buttonText');
const cableForm = document.getElementById('cableForm');
const popularPlansContainer = document.getElementById('popularPlans');
const confirmationModal = document.getElementById('confirmationModal');
const confirmationDetails = document.getElementById('confirmationDetails');
const closeModal = document.getElementById('closeModal');
const cancelPurchase = document.getElementById('cancelPurchase');
const confirmPurchase = document.getElementById('confirmPurchase');

// State variables
let selectedProvider = '';
let selectedProviderId = null;
let selectedPlan = null;
let activeSlideIndex = 0;
let isLoading = false;

// Initialize slider
function initSlider() {
    // Set initial provider selection
    const firstProvider = providerOptions[0];
    const provider = firstProvider.dataset.provider;
    const providerId = parseInt(firstProvider.dataset.providerId);
    selectProvider(provider, providerId);
    
    // Set up slider scroll event with debounce for better performance
    let scrollTimeout;
    providerSlider.addEventListener('scroll', function() {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(handleSliderScroll, 100);
    });
    
    // Set up indicator clicks
    sliderIndicators.forEach(indicator => {
        indicator.addEventListener('click', () => {
            const index = parseInt(indicator.dataset.index);
            scrollToSlide(index);
        });
    });
    
    // Set up provider option clicks
    providerOptions.forEach((option, index) => {
        option.addEventListener('click', () => {
            scrollToSlide(index);
            const provider = option.dataset.provider;
            const providerId = parseInt(option.dataset.providerId);
            selectProvider(provider, providerId);
        });
    });
}

// Handle slider scroll
function handleSliderScroll() {
    const scrollPosition = providerSlider.scrollLeft;
    const slideWidth = providerSlider.clientWidth;
    const newActiveSlide = Math.round(scrollPosition / slideWidth);
    
    if (newActiveSlide !== activeSlideIndex) {
        activeSlideIndex = newActiveSlide;
        updateIndicators();
        selectProviderOnScroll();
    }
}

// Select provider on scroll
function selectProviderOnScroll() {
    const activeSlide = providerOptions[activeSlideIndex];
    if (activeSlide) {
        const provider = activeSlide.dataset.provider;
        const providerId = parseInt(activeSlide.dataset.providerId);
        selectProvider(provider, providerId);
        
        // Visually mark the selected provider
        providerOptions.forEach(opt => opt.classList.remove('selected'));
        activeSlide.classList.add('selected');
    }
}

// Update slider indicators
function updateIndicators() {
    sliderIndicators.forEach((indicator, index) => {
        if (index === activeSlideIndex) {
            indicator.classList.add('active');
        } else {
            indicator.classList.remove('active');
        }
    });
}

// Scroll to specific slide
function scrollToSlide(index) {
    const slideWidth = providerSlider.clientWidth;
    providerSlider.scrollTo({
        left: slideWidth * index,
        behavior: 'smooth'
    });
    
    // Update active slide index and indicators immediately
    activeSlideIndex = index;
    updateIndicators();
    selectProviderOnScroll();
}

// Select provider
function selectProvider(provider, providerId) {
    // Reset previous selection
    providerOptions.forEach(opt => opt.classList.remove('selected'));
    
    // Find and mark the selected provider
    const selectedOption = Array.from(providerOptions).find(
        opt => opt.dataset.provider === provider
    );
    if (selectedOption) {
        selectedOption.classList.add('selected');
    }
    
    selectedProvider = provider;
    selectedProviderId = providerId;
    selectedProviderInput.value = provider;
    
    // Update cable plans dropdown
    updateCablePlans();
    
    // Update popular plans
    updatePopularPlans();
    
    // Reset selected plan
    selectedPlan = null;
    
    // Update button state
    updateSubmitButtonState();
}

// Update cable plans dropdown
function updateCablePlans() {
    // Clear existing options
    cablePlanSelect.innerHTML = '<option value="" disabled selected>Select Package</option>';
    
    if (selectedProvider && CABLE_PLANS[selectedProvider]) {
        const plans = CABLE_PLANS[selectedProvider];
        
        plans.forEach(plan => {
            const option = document.createElement('option');
            option.value = plan.id;
            option.textContent = `${plan.name} - ₦${plan.price.toLocaleString()}`;
            cablePlanSelect.appendChild(option);
        });
        
        cablePlanSelect.disabled = false;
    } else {
        cablePlanSelect.disabled = true;
    }
}

// Update popular plans
function updatePopularPlans() {
    // Clear existing plans
    popularPlansContainer.innerHTML = '';
    
    if (selectedProvider && POPULAR_PLANS[selectedProvider]) {
        const plans = POPULAR_PLANS[selectedProvider];
        
        plans.forEach(plan => {
            const planCard = document.createElement('div');
            planCard.className = 'plan-card';
            planCard.dataset.planId = plan.id;
            
            planCard.innerHTML = `
                <div class="plan-name">${plan.name}</div>
                <div class="plan-details">${plan.details}</div>
                <div class="plan-price">₦${plan.price.toLocaleString()}</div>
            `;
            
            planCard.addEventListener('click', () => {
                selectPlan(plan.id);
            });
            
            popularPlansContainer.appendChild(planCard);
        });
    }
}

// Select plan from popular plans
function selectPlan(planId) {
    // Update dropdown
    cablePlanSelect.value = planId;
    
    // Update selected plan
    if (selectedProvider && CABLE_PLANS[selectedProvider]) {
        const plans = CABLE_PLANS[selectedProvider];
        selectedPlan = plans.find(plan => plan.id === parseInt(planId));
    }
    
    // Update plan cards
    const planCards = document.querySelectorAll('.plan-card');
    planCards.forEach(card => {
        if (parseInt(card.dataset.planId) === parseInt(planId)) {
            card.classList.add('selected');
        } else {
            card.classList.remove('selected');
        }
    });
    
    // Update button state
    updateSubmitButtonState();
}

// Format currency
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-NG', { 
        style: 'currency', 
        currency: 'NGN',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(amount);
}

// Update submit button state
function updateSubmitButtonState() {
    const isFormValid = 
        selectedProvider && 
        selectedPlan && 
        iucNumberInput.value.trim().length > 0 &&
        !isLoading;
    
    submitButton.disabled = !isFormValid;
}

// Set loading state
function setLoading(loading) {
    isLoading = loading;
    
    if (loading) {
        buttonText.innerHTML = '<span class="loading"></span>Processing...';
    } else {
        buttonText.innerHTML = 'Pay Now';
    }
    
    submitButton.disabled = loading;
}

// Show toast notification
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    let icon = '';
    if (type === 'success') {
        icon = '<i class="fas fa-check-circle"></i>';
    } else if (type === 'error') {
        icon = '<i class="fas fa-exclamation-circle"></i>';
    } else {
        icon = '<i class="fas fa-info-circle"></i>';
    }
    
    toast.innerHTML = `
        <div class="toast-icon">${icon}</div>
        <div class="toast-content">
            <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    const toastContainer = document.getElementById('toastContainer');
    toastContainer.appendChild(toast);
    
    // Add close event
    toast.querySelector('.toast-close').addEventListener('click', () => {
        toast.style.animation = 'slideOutRight 0.3s ease-out forwards';
        setTimeout(() => {
            toast.remove();
        }, 300);
    });
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease-out forwards';
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 5000);
}

// Show confirmation modal
function showConfirmationModal() {
    if (!selectedPlan) return;
    
    confirmationDetails.innerHTML = `
        <div class="confirmation-item">
            <span class="confirmation-label">Provider:</span>
            <span class="confirmation-value">${selectedProvider}</span>
        </div>
        <div class="confirmation-item">
            <span class="confirmation-label">Package:</span>
            <span class="confirmation-value">${selectedPlan.name}</span>
        </div>
        <div class="confirmation-item">
            <span class="confirmation-label">IUC/Smart Card:</span>
            <span class="confirmation-value">${iucNumberInput.value}</span>
        </div>
        <div class="confirmation-item">
            <span class="confirmation-label">Amount:</span>
            <span class="confirmation-value">₦${selectedPlan.price.toLocaleString()}</span>
        </div>
    `;
    
    // Show modal
    confirmationModal.classList.add('active');
}

// Hide confirmation modal
function hideConfirmationModal() {
    confirmationModal.classList.remove('active');
}

// Process cable subscription
async function processCableSubscription() {
    // Show loading state in modal
    confirmPurchase.innerHTML = '<span class="loading"></span>Processing...';
    confirmPurchase.disabled = true;
    cancelPurchase.disabled = true;
    
    try {
        // Prepare payload
        const payload = {
            cable: selectedProviderId,
            iuc: iucNumberInput.value,
            cable_plan: selectedPlan.id,
            bypass: false,
            "request-id": `Cable_${Date.now()}${Math.floor(Math.random() * 1000)}`
        };
        
        // Make API request
        const response = await fetch('https://n3tdata.com/api/cable', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Token ${ACCESS_TOKEN}`
            },
            body: JSON.stringify(payload)
        });
        
        const data = await response.json();
        
        // Hide modal first
        hideConfirmationModal();
        
        if (data.status === 'success') {
            // Show success toast
            showToast(`${selectedPlan.name} subscription for ${selectedProvider} was successful!`, 'success');
            resetForm();
        } else {
            // Check if it's an insufficient funds error
            if (data.message && data.message.includes('Insufficient')) {
                showToast('Transaction failed', 'error');
            } else {
                showToast(data.message || 'Transaction failed', 'error');
            }
        }
    } catch (error) {
        console.error('Error processing subscription:', error);
        
        // Hide modal
        hideConfirmationModal();
        
        // Show error toast
        showToast('Transaction failed', 'error');
    } finally {
        // Reset button states
        confirmPurchase.innerHTML = 'Confirm Purchase';
        confirmPurchase.disabled = false;
        cancelPurchase.disabled = false;
    }
}

// Reset form
function resetForm() {
    selectedPlan = null;
    iucNumberInput.value = '';
    cablePlanSelect.value = '';
    updateSubmitButtonState();
    
    // Reset plan cards
    const planCards = document.querySelectorAll('.plan-card');
    planCards.forEach(card => {
        card.classList.remove('selected');
    });
}

// Event listeners
cablePlanSelect.addEventListener('change', function() {
    const planId = parseInt(this.value);
    
    if (selectedProvider && CABLE_PLANS[selectedProvider]) {
        const plans = CABLE_PLANS[selectedProvider];
        selectedPlan = plans.find(plan => plan.id === planId);
        
        // Update plan cards
        const planCards = document.querySelectorAll('.plan-card');
        planCards.forEach(card => {
            if (parseInt(card.dataset.planId) === planId) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        });
    }
    
    updateSubmitButtonState();
});

iucNumberInput.addEventListener('input', function() {
    updateSubmitButtonState();
});

cableForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (!selectedProvider || !selectedPlan || iucNumberInput.value.trim() === '') {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    showConfirmationModal();
});

// Modal event listeners
closeModal.addEventListener('click', hideConfirmationModal);
cancelPurchase.addEventListener('click', hideConfirmationModal);
confirmPurchase.addEventListener('click', processCableSubscription);

// Initialize the page
initSlider();
</script>
</body>
</html>